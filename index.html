<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>OAuthèªè¨¼ç‰ˆ Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æº</title>

    <link href='https://unpkg.com/fullcalendar@6.1.10/main.min.css' rel='stylesheet' />
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        #calendar {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        #auth-button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4285F4; /* Google Blue */
            color: white;
            border: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        #auth-button:hover {
            background-color: #357ae8;
        }
    </style>
</head>
<body>
    
    <div id="auth-status" style="text-align: center; margin-bottom: 20px;">
        <p id="status-message">éå…¬é–‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®äºˆå®šã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚</p>
        
        <button id="auth-button" onclick="initializeGis()">
            Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§äºˆå®šã‚’èª­ã¿è¾¼ã‚€
        </button>
    </div>
    
    <div id='calendar' style="display: none;"></div>

    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js' defer></script>
    
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.10/index.global.min.js' defer></script>
    
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core/locales/ja.global.min.js' defer></script>

    <script>
        // ==========================================================
        // ã€é‡è¦ã€‘è¨­å®šãŒå¿…è¦ãªç®‡æ‰€ (ã‚ãªãŸã®è¨­å®šå€¤ã‚’ç¶­æŒ)
        // ==========================================================
        // ğŸš¨ YOUR_CLIENT_ID: GCPã§å–å¾—ã—ãŸOAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID
        const CLIENT_ID = '376485449787-sk76t7tgmigbmqgm4h2vkkgr72hq1kl5.apps.googleusercontent.com';
        
        // ğŸ“… YOUR_CALENDAR_ID: ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„éå…¬é–‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®å®Œå…¨ãªIDï¼ˆ@ä»¥é™ã‚‚å«ã‚€ï¼‰
        const CALENDAR_ID = 'it.is.shotaime@google.com'; 
        
        // ğŸ”’ ã‚¹ã‚³ãƒ¼ãƒ— (ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®èª­ã¿å–ã‚Šå°‚ç”¨ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¦æ±‚)
        const SCOPE = 'https://www.googleapis.com/auth/calendar.readonly';
        // ==========================================================

        let calendar = null;
        let accessToken = null;

        // window.onload + setTimeout ã§åˆæœŸåŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œã‚’è§£æ¶ˆ
        window.onload = function() {
            setTimeout(function() {
                var calendarEl = document.getElementById('calendar');

                calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    locale: 'ja',
                    plugins: [ 'dayGrid', 'googleCalendar' ], 
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    googleCalendarApiKey: null,
                    eventSources: [],
                    
                    eventSourceFailure: function(error) {
                        console.error('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                        alert('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã¾ãŸã¯èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    }
                });
            }, 50);
        };
        
        function initializeGis() {
            google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPE,
                callback: (tokenResponse) => {
                    if (tokenResponse.error !== undefined) {
                        console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', tokenResponse);
                        alert('èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚GCPã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURLã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }
                    accessToken = tokenResponse.access_token;
                    loadCalendarEvents(accessToken);
                },
            }).requestAccessToken();
        }

        function loadCalendarEvents(token) {
            if (!calendar) {
                 setTimeout(() => loadCalendarEvents(token), 100);
                 return;
            }

            document.getElementById('status-message').textContent = 'èªè¨¼æˆåŠŸï¼ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™...';
            document.getElementById('auth-status').style.display = 'none';
            document.getElementById('calendar').style.display = 'block';

            calendar.setOption('eventSources', [
                {
                    googleCalendarId: CALENDAR_ID,
                    headers: {
                        Authorization: 'Bearer ' + token
                    }
                }
            ]);

            calendar.render();
        }
        
        window.initializeGis = initializeGis; 
    </script>
</body>
</html>
